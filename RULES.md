# 메타한글 입력기 핵심 규칙 명세서

## 개요

본 문서는 메타한글 입력기 프레임워크의 핵심 규칙을 정의한다. 하기 명시된 네 가지 규칙을 준수함으로써, 메타한글 입력기는 키보드 기반 한글 입력 방식의 대부분을 통합적으로 지원할 수 있다.

## 규칙 1: 조합 순서 (Composition Order)

### 1.1 순차적 조합 모드 (Sequential Mode)
대부분의 한글 입력기는 엄격한 순차적 조합 규칙을 따른다:
- **허용된 순서**: 초성(Choseong) → 중성(Jungseong) → 종성(Jongseong)
- **제약사항**: 역순 조합 불가 (예: 중성 → 초성 순서 불허)

### 1.2 자유 조합 모드 (Free Order Mode)
일부 입력기는 조합 순서에 대한 제약이 없다:
- **허용 예시**: 
  - 초성 → 종성 → 중성
  - 종성 → 중성 → 초성
  - 기타 다양한 순서 조합
- **제약사항**: 동일 위치에 대한 분할 조합은 불허
  - 불허 예시: 초성 → 종성 → 초성 → 중성
  - 불허 예시: 초성 → 중성 → 종성 → 중성

## 규칙 2: 종성부용초성 (Standalone Cluster)

### 2.1 정의
종성 전용 자음 조합(예: ㄳ, ㄵ, ㄶ 등)의 단독 사용 허용 여부를 결정하는 규칙이다.

### 2.2 허용 모드

#### 2.2.1 기본 동작
- 초성 위치에서 종성 전용 조합 입력 가능
- 종성에서만 허용되는 입력이 들어올 경우, 기존 조합을 종성으로 재해석
- **예시**: 초성 위치에서 ㄱ + ㅅ 입력 → ㄳ (종성으로 재해석)

#### 2.2.2 '종성부용초성 되돌리기'
- 종성부용초성 모드가 활성화되어 있을 경우 동작
- 백스페이스로 인해 삭제되고 현재 남은 종성이 초성으로도 해석 가능할 경우, 초성으로 재해석
- **예시**: ㄳ(종성) → 백스페이스 → ㄱ(초성)

### 2.3 불허 모드
- 초성 위치에서 종성 전용 조합 입력 불가
- 각 자음을 별개의 음절로 처리
- **예시**: 초성 위치에서 ㄱ + ㅅ 입력 → ㄱㅅ (양쪽 모두 초성, 별개 음절)

## 규칙 3: 커밋 단위 (Commit Unit)

### 3.1 음절 단위 커밋 (Syllable Commit)
- **특징**: 음절 단위로 텍스트 확정 및 관리
- **삭제 동작**: 확정된 이전 글자는 음절 단위로만 삭제 가능
- **예시**: 
  - 입력: 갃 → ㅣ → 각시
  - 백스페이스: 각시 → 각ㅅ → 각 → (빈 상태)

### 3.2 명시적 커밋 (Explicit Commit)
- **특징**: 비한글 문자 입력 또는 명시적 커밋 요청시에만 커밋 발생
- **삭제 동작**: 미확정 글자는 낱자 단위로 삭제 가능

#### 3.3.1 역 도깨비불 현상
- **정의**: 백스페이스 후 남은 초성이 커밋되지 않은 이전 음절에 결합 가능할 경우, 해당 초성을 이전 음절에 결합
- **예시**: 
  - 입력: 갃 → ㅣ → 각시
  - 백스페이스: 각시 → 갃 → 각 → 가

## 규칙 4: 조합 표시 규칙 (Display Mode)

### 4.1 옛한글 표시 (Archaic Mode)
- **적용 대상**: 옛한글 지원 입력기
- **표시 방식**: 조합 불가능한 자모는 NFD(Normalization Form Canonical Decomposition)로 표기
- **특징**: 현대 한글로 조합되지 않는 글자도 정규화된 형태로 표시

### 4.2 현대 한글 표시 - 다중 음절 (Modern Multiple)
- **적용 대상**: 현대 한글 전용 입력기
- **표시 방식**: 조합 불가능한 자모를 여러 개의 음절로 분리 표시
- **예시**: 초성 ㄱ + 종성 ㄱ → ㄱㄱ (두 개의 음절)

### 4.3 현대 한글 표시 - 부분 표시 (Modern Partial)
- **적용 대상**: 현대 한글 전용 입력기
- **표시 방식**: 조합 가능한 부분만 선택적 표시
- **예시**: 초성 ㄱ + 종성 ㄱ → ㄱ (초성만 표시)

## 결론

상기 네 가지 핵심 규칙의 조합을 통해, 메타한글 입력기는 다양한 한글 입력 방식을 복잡한 고민 없이 내재적으로 지원할 수 있다.